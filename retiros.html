<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Airconekta Â· Retiros (3+)</title>

<!--
===========================================================
Firma / Autor (solo visible al depurar o ver cÃ³digo fuente)
Jair Elizondo
+52 322 243 9782
Hint: #whoami
===========================================================
-->

<style>
:root{
  --ink:#0f1a2e; --muted:#5b6b86; --accent:#246bff; --border:#cfe0ff;
  --card: rgba(255,255,255,.78);
  --shadow: 0 14px 40px rgba(16,48,96,.12);
  --ring: 0 0 0 4px rgba(36,107,255,.16);
}

/* Base */
*{ box-sizing:border-box; }
html,body{ height:100%; }
body{margin:0;font:16px system-ui;background:#fff;color:var(--ink)}

/* Layout original */
.wrap{max-width:1200px;margin:auto;padding:20px}
.top{position:sticky;top:0;background:#fff;padding-bottom:10px;z-index:5}
input{width:100%;padding:12px;border:1px solid var(--border);border-radius:12px}

table{width:100%;border-collapse:collapse;margin-top:12px}
th,td{border-bottom:1px solid #eef3ff;padding:10px;text-align:left;vertical-align:top}
th{
  color:var(--muted);
  user-select:none;
  white-space:nowrap;
  position:sticky; top:0; background:#fff; z-index:2;
}

/* âœ… estilo "botÃ³n" clickeable */
th.sortable{
  cursor:pointer;
  touch-action:manipulation;
}
th.sortable:hover{
  color:var(--ink);
  background:rgba(36,107,255,.06);
}
th.sortable:active{
  background:rgba(36,107,255,.12);
}
th.sort-active{
  color:var(--ink);
  background:rgba(36,107,255,.06);
  border-bottom:2px solid rgba(36,107,255,.35);
}

th .arrow{
  font-size:.85em;
  margin-left:6px;
  opacity:.85;
}

button{
  border:1px solid var(--accent);background:#fff;color:var(--accent);
  padding:6px 10px;border-radius:10px;font-weight:800;cursor:pointer
}
button:disabled{opacity:.5}
.ok{color:#1f9d55;font-weight:800}
.muted{color:var(--muted)}

/* ========================= Splash Screen (Airconekta) ========================= */
.splash{
  position:fixed;
  inset:0;
  display:grid;
  place-items:center;
  background:
    radial-gradient(900px 520px at 20% 15%, rgba(36,107,255,.28), transparent 60%),
    radial-gradient(900px 520px at 85% 25%, rgba(24,198,255,.22), transparent 55%),
    radial-gradient(900px 520px at 45% 100%, rgba(124,58,237,.18), transparent 60%),
    linear-gradient(180deg, #070b14, #0b1220);
  z-index:9999;
  transition: opacity .35s ease, transform .35s ease, visibility .35s ease;
}
.splash.hide{
  opacity:0;
  transform: translateY(-6px);
  visibility:hidden;
  pointer-events:none;
}
.splash-card{
  width:min(92vw, 560px);
  border-radius: 28px;
  padding: 28px 22px;
  text-align:center;
  color:#eaf2ff;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(10,16,30,.55);
  box-shadow: 0 30px 90px rgba(0,0,0,.6);
  backdrop-filter: blur(14px) saturate(120%);
}
.splash-logo{
  width: 88px;
  height: 88px;
  margin: 0 auto 10px;
  border-radius: 26px;
  display:grid;
  place-items:center;
  background: rgba(255,255,255,.06);
  border: 1px solid rgba(255,255,255,.12);
  position:relative;
  overflow:hidden;
}
.splash-logo::before{
  content:"";
  position:absolute;
  inset:-40%;
  background: conic-gradient(
    from 0deg,
    rgba(36,107,255,.0),
    rgba(36,107,255,.6),
    rgba(24,198,255,.55),
    rgba(124,58,237,.55),
    rgba(36,107,255,.0)
  );
  animation: spin 2.4s linear infinite;
  opacity:.9;
}
.splash-logo .logo-img{
  position:relative;
  width: 62px;
  height: 62px;
  border-radius: 22px;
  display:block;
  background: rgba(11,18,32,.92);
  border:1px solid rgba(255,255,255,.12);
  object-fit: contain;
  padding: 10px;
}
.splash-title{
  font-weight: 1000;
  letter-spacing: .6px;
  font-size: clamp(2.0rem, 4.2vw, 3.0rem);
  margin: 8px 0 6px;
}
.splash-sub{
  margin: 0;
  color: rgba(233,238,252,.78);
  font-weight: 700;
}
.splash-bar{
  height: 10px;
  margin: 16px auto 0;
  border-radius: 999px;
  width: min(380px, 82%);
  background: rgba(255,255,255,.08);
  border: 1px solid rgba(255,255,255,.10);
  overflow:hidden;
}
.splash-bar > i{
  display:block;
  height:100%;
  width: 40%;
  background: linear-gradient(90deg, rgba(36,107,255,.15), rgba(36,107,255,.85), rgba(24,198,255,.85));
  border-radius: 999px;
  animation: load 1.1s ease-in-out infinite;
  filter: drop-shadow(0 6px 14px rgba(36,107,255,.20));
}
@keyframes load{
  0%{ transform: translateX(-30%); opacity:.65; }
  50%{ transform: translateX(120%); opacity:1; }
  100%{ transform: translateX(260%); opacity:.65; }
}
@keyframes spin{ to{ transform: rotate(360deg);} }
@media (prefers-reduced-motion: reduce){
  .splash-logo::before, .splash-bar > i{ animation:none !important; }
  .splash{ transition:none; }
}

/* ========================= WHOAMI modal (hash) ========================= */
body.whoami-open{ overflow:hidden; }
.whoami{
  position:fixed;
  inset:0;
  display:none;
  place-items:center;
  z-index:9998;
  padding:18px;
  background: rgba(7,11,20,.70);
  backdrop-filter: blur(10px) saturate(120%);
}
.whoami.show{ display:grid; }
.who-card{
  width:min(980px, 100%);
  border-radius: 26px;
  border:1px solid rgba(207,224,255,.35);
  background: rgba(255,255,255,.92);
  box-shadow: 0 30px 90px rgba(0,0,0,.35);
  overflow:hidden;
}
.who-head{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  padding:16px 16px 12px;
  border-bottom:1px solid rgba(207,224,255,.65);
  background:
    radial-gradient(700px 240px at 10% 0%, rgba(36,107,255,.18), transparent 55%),
    radial-gradient(700px 240px at 90% 0%, rgba(24,198,255,.14), transparent 55%),
    #fff;
}
.who-title{
  margin:0;
  font-size:1.25rem;
  font-weight:1000;
}
.who-sub{
  margin:2px 0 0;
  color:var(--muted);
  font-weight:800;
  font-size:.95rem;
}
.who-close{
  border:1px solid rgba(36,107,255,.35);
  background:#fff;
  color:var(--ink);
  padding:10px 12px;
  border-radius:14px;
  font-weight:1000;
  cursor:pointer;
}
.who-close:hover{ box-shadow: var(--ring); }
.who-body{
  padding:16px;
  display:grid;
  grid-template-columns: 1.1fr .9fr;
  gap:14px;
}
@media (max-width:860px){
  .who-body{ grid-template-columns:1fr; }
}
.who-panel{
  border:1px solid rgba(207,224,255,.75);
  border-radius: 20px;
  padding:14px;
  background: rgba(255,255,255,.78);
}
.who-hero{
  display:flex;
  gap:14px;
  align-items:center;
  flex-wrap:wrap;
}
.who-avatar{
  width:72px;height:72px;border-radius:22px;
  border:1px solid rgba(207,224,255,.85);
  background:
    radial-gradient(60px 60px at 30% 20%, rgba(36,107,255,.35), transparent 60%),
    radial-gradient(60px 60px at 90% 30%, rgba(24,198,255,.28), transparent 55%),
    radial-gradient(60px 60px at 40% 95%, rgba(124,58,237,.22), transparent 60%),
    rgba(255,255,255,.85);
  display:grid;place-items:center;
  font-weight:1000;letter-spacing:.6px;
}
.who-name{ margin:0; font-size:1.15rem; font-weight:1000; }
.who-role{ margin:2px 0 0; color:var(--muted); font-weight:900; }

.who-grid{
  display:grid;
  grid-template-columns:repeat(12,1fr);
  gap:10px;
  margin-top:12px;
}
.who-k{
  grid-column:span 6;
  border:1px solid rgba(207,224,255,.75);
  border-radius: 16px;
  padding:10px;
  background: rgba(255,255,255,.70);
}
@media (max-width:860px){ .who-k{ grid-column:span 12; } }
.who-k strong{ display:block; margin-bottom:4px; font-weight:1000; }
.who-actions{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-top:12px;
}
.wbtn{
  appearance:none;
  cursor:pointer;
  user-select:none;
  border:1px solid rgba(36,107,255,.65);
  color:var(--ink);
  background:#fff;
  padding:12px 14px;
  border-radius: 14px;
  font-weight: 1000;
  letter-spacing:.2px;
  text-decoration:none;
  display:inline-flex;
  align-items:center;
  gap:8px;
  line-height:1;
}
.wbtn:hover{ box-shadow: var(--ring); border-color: rgba(36,107,255,.95); }
.wbtn-primary{
  color:#fff;
  border-color: transparent;
  background: linear-gradient(135deg, var(--accent), #18c6ff);
}
.who-tip{
  margin-top:12px;
  padding:12px;
  border-radius:16px;
  border:1px dashed rgba(207,224,255,.95);
  background: rgba(247,251,255,.85);
  color:var(--muted);
  font-weight:800;
}
</style>
</head>

<body>

<!-- Splash (Airconekta) -->
<div class="splash" id="splash" aria-label="Cargando Airconekta">
  <div class="splash-card" role="status" aria-live="polite">
    <div class="splash-logo" aria-hidden="true">
      <img class="logo-img" alt=""
        src="https://raw.githubusercontent.com/airconekta/airconekta/refs/heads/main/airconekta_logo_transparent.png" />
    </div>
    <div class="splash-title">AIRCONEKTA</div>
    <p class="splash-sub">Retiros (3+) Â· Panel interno</p>
    <div class="splash-bar" aria-hidden="true"><i></i></div>
    <p style="margin:10px 0 0;color:rgba(233,238,252,.72);font-weight:800;font-size:.95rem">
      Toca para entrar
    </p>
  </div>
</div>

<!-- WHOAMI modal (solo con #whoami) -->
<div class="whoami" id="whoami" aria-hidden="true">
  <div class="who-card" role="dialog" aria-modal="true" aria-label="Whoami">
    <div class="who-head">
      <div>
        <p class="who-title">Whoami</p>
        <p class="who-sub">Vista especial (solo con <strong>#whoami</strong>)</p>
      </div>
      <button class="who-close" type="button" id="whoCloseBtn">âœ• Cerrar</button>
    </div>

    <div class="who-body">
      <div class="who-panel">
        <div class="who-hero">
          <div class="who-avatar" aria-hidden="true">JE</div>
          <div>
            <p class="who-name" id="whoName">Jair Elizondo</p>
            <p class="who-role" id="whoRole">Soporte / Instalaciones Â· Airconekta</p>
          </div>
        </div>

        <div class="who-grid">
          <div class="who-k">
            <strong>ðŸ“ž TelÃ©fono</strong>
            <span class="muted" id="whoPhonePretty">322 243 9782</span>
          </div>
          <div class="who-k">
            <strong>ðŸŸ¢ WhatsApp</strong>
            <span class="muted">Abrir chat directo</span>
          </div>
          <div class="who-k">
            <strong>ðŸ”Ž Debug</strong>
            <span class="muted">Solo visible por hash</span>
          </div>
          <div class="who-k">
            <strong>ðŸ§  Tip</strong>
            <span class="muted">TambiÃ©n estÃ¡ tu firma en consola</span>
          </div>
        </div>

        <div class="who-actions">
          <a class="wbtn wbtn-primary" id="whoWhatsBtn" href="#" rel="noopener noreferrer">ðŸŸ¢ Abrir chat</a>
          <a class="wbtn" id="whoCallBtn" href="#">ðŸ“ž Llamar</a>
          <button class="wbtn" type="button" id="whoCopyBtn">ðŸ“‹ Copiar datos</button>
        </div>

        <div class="who-tip">
          Pro tip: escribe <strong>#whoami</strong> al final de la URL. Para salir: cierra o borra el hash.
        </div>
      </div>

      <div class="who-panel">
        <p style="margin:0 0 8px;font-weight:1000">âœ… Â¿CÃ³mo sÃ© que funcionÃ³?</p>
        <div class="who-tip" style="margin-top:0">
          <strong>1)</strong> Abre DevTools â†’ Console: verÃ¡s tu firma.<br><br>
          <strong>2)</strong> Ctrl+U: verÃ¡s el bloque de firma en comentarios.<br><br>
          <strong>3)</strong> Agrega <strong>#whoami</strong> y te abre esta pantalla.
        </div>
      </div>
    </div>
  </div>
</div>

<div class="wrap">
  <div class="top">
    <h2>ðŸ“¡ Airconekta â€“ Retiros (3+)</h2>
    <input id="q" placeholder="Buscar por direcciÃ³n, barrio, telÃ©fono, planâ€¦">
    <div id="status" class="muted">Cargandoâ€¦</div>
  </div>

  <table>
    <thead>
      <tr>
        <th class="sortable" data-col="DirecciÃ³n">DirecciÃ³n <span class="arrow" id="a-DirecciÃ³n"></span></th>
        <th class="sortable" data-col="Barrio/Localidad">Barrio/Localidad <span class="arrow" id="a-Barrio/Localidad"></span></th>
        <th class="sortable" data-col="Plan Internet">Plan Internet <span class="arrow" id="a-Plan Internet"></span></th>
        <th class="sortable" data-col="Telefono">Telefono <span class="arrow" id="a-Telefono"></span></th>
        <th class="sortable" data-col="Plan Precio">Plan Precio <span class="arrow" id="a-Plan Precio"></span></th>
        <th class="sortable" data-col="Pagos Pendientes">Pagos Pendientes <span class="arrow" id="a-Pagos Pendientes"></span></th>
        <th class="sortable" data-col="Adeudos">Adeudos <span class="arrow" id="a-Adeudos"></span></th>
        <th class="sortable" data-col="Comentario">Comentario <span class="arrow" id="a-Comentario"></span></th>
        <th>AcciÃ³n</th>
      </tr>
    </thead>
    <tbody id="tb"></tbody>
  </table>
</div>

<script>
/* =====================
   CONFIG + FIRMA
===================== */
const API_URL = "https://script.google.com/macros/s/AKfycbzyys9F3FAGxnJEBCkYXOMH16xMFaouuThHahpa7rjzfTp-YTpY4J95U-n7v0f7l2U4/exec";
const API_KEY = "retiros2025x";

const WHOAMI = {
  name: "Jair Elizondo",
  phonePretty: "322 243 9782",
  phoneDigits: "3222439782",
  role: "Soporte / Instalaciones Â· Airconekta",
  hint: "#whoami",
  webHint: "Escribe #whoami al final de la URL"
};

// Firma en consola (solo al depurar)
(function consoleSignature(){
  try{
    const line = "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”";
    console.log("%c" + line, "color:#18c6ff;font-weight:900");
    console.log("%cAIRCONEKTA Â· Firma de desarrollo", "color:#246bff;font-size:14px;font-weight:900");
    console.log("%c" + WHOAMI.name + "  Â·  " + WHOAMI.phonePretty + "  Â·  " + WHOAMI.hint, "color:#7c3aed;font-size:12px;font-weight:900");
    console.log("%c" + WHOAMI.webHint, "color:#5b6b86;font-size:12px;font-weight:800");
    console.log("%c" + line, "color:#18c6ff;font-weight:900");
  }catch{}
})();

/* =====================
   Splash (3s o click)
===================== */
const splash = document.getElementById("splash");
const hideSplash = () => splash?.classList.add("hide");
splash?.addEventListener("click", hideSplash, { passive:true });
window.addEventListener("load", () => setTimeout(hideSplash, 3000));

/* =====================
   WHOAMI (hash route)
===================== */
const whoModal = document.getElementById("whoami");

function openWhoami(){
  // Render
  document.getElementById("whoName").textContent = WHOAMI.name;
  document.getElementById("whoRole").textContent = WHOAMI.role;
  document.getElementById("whoPhonePretty").textContent = WHOAMI.phonePretty;

  const waLink =
    `https://api.whatsapp.com/send?phone=52${WHOAMI.phoneDigits}` +
    `&text=${encodeURIComponent("Hola ðŸ‘‹ " + WHOAMI.name + ", necesito soporte / info de Airconekta.")}` +
    `&type=phone_number&app_absent=0`;

  document.getElementById("whoWhatsBtn").setAttribute("href", waLink);
  document.getElementById("whoCallBtn").setAttribute("href", `tel:+52${WHOAMI.phoneDigits}`);

  document.getElementById("whoCopyBtn").onclick = async () => {
    const text =
      `${WHOAMI.name}\n` +
      `${WHOAMI.phonePretty}\n` +
      `Airconekta\n` +
      `Tip: ${location.origin + location.pathname}#whoami`;
    try{
      await navigator.clipboard.writeText(text);
      alert("Datos copiados âœ…");
    }catch{
      alert("No se pudo copiar (permiso del navegador)");
    }
  };

  // Show
  document.body.classList.add("whoami-open");
  whoModal.classList.add("show");
  whoModal.setAttribute("aria-hidden","false");
}

function closeWhoami(){
  document.body.classList.remove("whoami-open");
  whoModal.classList.remove("show");
  whoModal.setAttribute("aria-hidden","true");

  // limpiar hash sin recargar
  if (location.hash) history.replaceState(null, "", location.pathname + location.search);
}

document.getElementById("whoCloseBtn").addEventListener("click", closeWhoami);

// click fuera para cerrar
whoModal.addEventListener("click", (e)=>{
  if (e.target === whoModal) closeWhoami();
});

// ESC para cerrar
window.addEventListener("keydown", (e)=>{
  if (e.key === "Escape" && whoModal.classList.contains("show")) closeWhoami();
});

function handleHashRoute(){
  const h = (location.hash || "").toLowerCase().trim();
  if (h === "#whoami") openWhoami();
  else closeWhoami();
}
window.addEventListener("hashchange", handleHashRoute, { passive:true });

/* =====================
   TU CÃ“DIGO ORIGINAL (sin cambios)
===================== */
const tb = document.getElementById("tb");
const q  = document.getElementById("q");
const statusEl = document.getElementById("status");

let rows = [];
let rowsOriginal = [];
let sortState = { col: null, mode: 0 }; // 0 original, 1 asc, 2 desc

const norm = v => String(v ?? "").toLowerCase().trim();

function toNum(v){
  if (typeof v === "number") return v;
  const s = String(v ?? "");
  const nums = s.replace(/,/g,' ').match(/\d+(?:\.\d+)?/g);
  if(!nums || !nums.length) return 0;
  return parseFloat(nums[nums.length-1]) || 0;
}

async function load(){
  statusEl.textContent = "Cargandoâ€¦";
  const r = await fetch(API_URL + "?key=" + encodeURIComponent(API_KEY));
  const j = await r.json();
  if(!j.ok) throw j;

  rows = (j.rows || []).map((x,i)=> ({...x, _origIndex:i}));
  rowsOriginal = rows.slice();

  sortState = { col:null, mode:0 };
  updateArrows();
  render();
}

function getFiltered(){
  const f = norm(q.value);
  if (!f) return rows.slice();
  return rows.filter(r =>
    norm(r["DirecciÃ³n"]).includes(f) ||
    norm(r["Barrio/Localidad"]).includes(f) ||
    norm(r["Telefono"]).includes(f) ||
    norm(r["Plan Internet"]).includes(f) ||
    norm(r["Comentario"]).includes(f)
  );
}

function render(){
  const data = getFiltered();
  statusEl.textContent = `Mostrando ${data.length} de ${rows.length}`;

  tb.innerHTML = data.map(r=>{
    const c = String(r["Comentario"]||"").trim();
    const marked = c.length>0;
    return `
      <tr>
        <td>${r["DirecciÃ³n"]||""}</td>
        <td>${r["Barrio/Localidad"]||""}</td>
        <td>${r["Plan Internet"]||""}</td>
        <td>${r["Telefono"]||""}</td>
        <td>${r["Plan Precio"]||""}</td>
        <td>${r["Pagos Pendientes"]||""}</td>
        <td><b>${r["Adeudos"]||""}</b></td>
        <td>${marked?`<span class="ok">${c}</span>`:`<span class="muted">â€”</span>`}</td>
        <td>
          <button ${marked?"disabled":""} onclick="mark(${r._row})">
            ${marked?"Listo":"RETIRADO"}
          </button>
        </td>
      </tr>
    `;
  }).join("");
}

function applySort(col, mode){
  if (mode === 0){
    rows = rowsOriginal.slice();
    return;
  }

  const numericCols = new Set(["Plan Precio","Pagos Pendientes","Adeudos"]);

  rows.sort((a,b)=>{
    let av = a[col], bv = b[col];

    if (numericCols.has(col)){
      av = toNum(av); bv = toNum(bv);
      return mode === 1 ? (av - bv) : (bv - av);
    }

    av = norm(av); bv = norm(bv);
    if (av < bv) return mode === 1 ? -1 : 1;
    if (av > bv) return mode === 1 ? 1 : -1;
    return a._origIndex - b._origIndex;
  });
}

function updateArrows(){
  document.querySelectorAll("th.sortable").forEach(th=>{
    th.classList.remove("sort-active");
    const col = th.getAttribute("data-col");
    const span = document.getElementById("a-" + col);
    if (span) span.textContent = "";
  });

  if (!sortState.col) return;

  const th = document.querySelector(`th.sortable[data-col="${CSS.escape(sortState.col)}"]`);
  if (th) th.classList.add("sort-active");

  const span = document.getElementById("a-" + sortState.col);
  if (!span) return;

  // 0 = original, 1 asc, 2 desc
  span.textContent = sortState.mode === 1 ? "â–²" : sortState.mode === 2 ? "â–¼" : "â†º";
}

function cycleSort(col){
  if (sortState.col !== col){
    sortState = { col, mode: 1 };
  } else {
    sortState.mode = (sortState.mode === 1) ? 2 : (sortState.mode === 2) ? 0 : 1;
  }
  applySort(sortState.col, sortState.mode);
  updateArrows();
  render();
}

async function mark(row){
  if(!confirm("Â¿Marcar como RETIRADO?")) return;
  await fetch(API_URL,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({key:API_KEY,row,action:"RETIRADO"})
  });
  load();
}

q.addEventListener("input", render);

document.querySelectorAll("th.sortable").forEach(th=>{
  th.addEventListener("click", ()=>{
    const col = th.getAttribute("data-col");
    cycleSort(col);
  });
});

load().catch((e)=>{
  console.error(e);
  statusEl.textContent="ERROR: API_KEY o permisos";
});

// Init hash route (si abre directo con #whoami)
handleHashRoute();
</script>
</body>
</html>
