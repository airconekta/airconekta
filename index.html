<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Airconekta ¬∑ Solicitar Instalaci√≥n</title>
  <meta name="theme-color" content="#0b1220" />
  <meta name="color-scheme" content="light">
  <meta name="description" content="Formulario profesional para solicitar instalaci√≥n y enviar datos v√≠a WhatsApp.">

  <!-- Logos Airconekta (para splash y PWA) -->
  <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/airconekta/airconekta/refs/heads/main/airconekta_logo_512.png" />
  <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/airconekta/airconekta/refs/heads/main/airconekta_logo_512.png" />

  <!--
    ===========================================================
    Firma / Autor (solo visible al depurar o ver c√≥digo fuente)
    Jair Elizondo
    +52 322 243 9782
    Hint: #whoami
    ===========================================================
  -->

  <style>
    :root{
      --bg: #ffffff;
      --bg-2: #ffffff;
      --ink: #0f1a2e;
      --muted: #5b6b86;
      --accent: #246bff;
      --border: #cfe0ff;
      --ok: #1f9d55;
      --radius: 18px;
      --shadow: 0 10px 26px rgba(16,48,96,.10);

      --logo-1024: url("https://raw.githubusercontent.com/airconekta/airconekta/refs/heads/main/airconekta_logo_1024.png");
      --logo-512: url("https://raw.githubusercontent.com/airconekta/airconekta/refs/heads/main/airconekta_logo_512.png");
      --logo-trans: url("https://raw.githubusercontent.com/airconekta/airconekta/refs/heads/main/airconekta_logo_transparent.png");
    }

    *{ box-sizing: border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font:16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      background:#fff;
      color:var(--ink);
    }

    .shell{ max-width:920px; margin:0 auto; padding:24px; }

    .nav{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:16px 18px; border-radius:var(--radius);
      background:var(--bg-2);
      border:1px solid var(--border);
      box-shadow:var(--shadow);
      position:sticky; top:12px; backdrop-filter:saturate(110%);
      z-index:10;
    }
    .brand{ display:flex; gap:12px; align-items:center; font-weight:800; letter-spacing:.2px; color:var(--ink); }
    .brand .logo{
      width:36px; height:36px; border-radius:12px; display:grid; place-items:center;
      background:#fff; border:1px solid var(--border); color:var(--accent);
      overflow:hidden;
    }
    .brand .logo img{ width:22px; height:22px; object-fit:contain; display:block; }
    .brand .logo span{ font-size:18px; }

    .card{
      margin-top:24px; padding:22px; border-radius:22px;
      background:var(--bg-2);
      border:1px solid var(--border);
      box-shadow:var(--shadow);
    }

    h1{ font-size:1.5rem; margin:0 0 6px; color:var(--ink); }
    .lead{ color:var(--muted); margin:0 0 16px; }

    form{ display:grid; grid-template-columns:repeat(12,1fr); gap:14px; }
    .col-12{ grid-column:span 12; }
    .col-6{ grid-column:span 6; }
    .col-4{ grid-column:span 4; }
    @media (max-width:860px){ .col-6,.col-4{ grid-column:span 12; } }

    label{ display:block; font-size:.92rem; color:var(--muted); margin:4px 0 6px; }
    input,select{
      width:100%; padding:12px 14px; border-radius:14px;
      border:1px solid var(--border); background:#fff; color:var(--ink);
      outline:none; transition:border .15s ease, box-shadow .15s ease, transform .06s ease;
    }
    input:focus,select:focus{
      border-color:var(--accent);
      box-shadow:0 0 0 3px rgba(36,107,255,.12);
      background:#fff;
    }
    input:active,select:active{ transform:translateY(.5px); }

    .inline{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; }

    .btn{
      appearance:none; cursor:pointer; user-select:none;
      border:1px solid var(--accent); color:var(--accent);
      background:#fff;
      padding:12px 16px; border-radius:14px; font-weight:700; letter-spacing:.2px;
      transition: background .15s ease, color .15s ease, box-shadow .15s ease, transform .06s ease;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .btn:hover{ background:rgba(36,107,255,.06); box-shadow:0 0 0 3px rgba(36,107,255,.12); }
    .btn:active{ transform:translateY(1px); }

    .btn-primary{
      background:var(--accent); color:#fff; border-color:var(--accent);
    }
    .btn-primary:hover{ box-shadow:0 0 0 3px rgba(36,107,255,.20); }

    .status{ font-size:.9rem; color:var(--muted); }

    .footer{
      margin:20px 0 0; color:var(--muted); font-size:.9rem;
      display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px;
    }

    .toast{
      position:fixed; left:50%; bottom:24px; transform:translateX(-50%) translateY(16px); opacity:0; pointer-events:none;
      background:#fff; color:var(--ink); padding:10px 14px; border-radius:12px;
      border:1px solid var(--accent); box-shadow:0 8px 20px rgba(16,48,96,.10); transition:.18s ease;
      z-index:50;
    }
    .toast.show{ transform:translateX(-50%) translateY(0); opacity:1; }

    /* ===== Pantalla inicial (compatible y sin "slide") ===== */
    .welcome{
      position:fixed; inset:0;
      background:#fff;
      z-index:9000;
      display:flex;
      flex-direction:column;
    }
    .welcome-top{
      padding:18px 18px 10px;
      border-bottom:1px solid var(--border);
    }
    .welcome-title{
      margin:0;
      font-size:1.25rem;
      color:var(--ink);
      font-weight:900;
    }
    .welcome-sub{
      margin:6px 0 0;
      color:var(--muted);
      font-size:.95rem;
    }
    .welcome-body{
      padding:14px 18px 18px;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
    }
    .welcome-grid{
      display:grid;
      grid-template-columns:1fr;
      gap:10px;
    }
    .welcome-btn{
      width:100%;
      border:1px solid var(--border);
      border-radius:16px;
      padding:14px 14px;
      background:#fff;
      color:var(--ink);
      font-weight:800;
      text-align:left;
      cursor:pointer;
    }
    .welcome-btn:active{ transform:translateY(1px); }
    .welcome-footer{
      padding:12px 18px 18px;
      border-top:1px solid var(--border);
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }
    .welcome-select{
      width:100%;
      border-radius:14px;
      padding:12px 14px;
      border:1px solid var(--border);
      background:#fff;
      color:var(--ink);
    }
    /* Ocultar app hasta que elijan colonia */
    .app-hidden body{ visibility:hidden; }
    .app-hidden #welcome{ visibility:visible; }

    /* ========================= Splash Screen Airconekta ========================= */
    .splash{
      position:fixed;
      inset:0;
      display:grid;
      place-items:center;
      background:
        radial-gradient(900px 520px at 20% 15%, rgba(36,107,255,.28), transparent 60%),
        radial-gradient(900px 520px at 85% 25%, rgba(24,198,255,.22), transparent 55%),
        radial-gradient(900px 520px at 45% 100%, rgba(124,58,237,.18), transparent 60%),
        linear-gradient(180deg, #070b14, #0b1220);
      z-index:9999;
      transition: opacity .35s ease, transform .35s ease, visibility .35s ease;
    }
    .splash.hide{
      opacity:0;
      transform: translateY(-6px);
      visibility:hidden;
      pointer-events:none;
    }
    .splash-card{
      width:min(92vw, 560px);
      border-radius: 28px;
      padding: 28px 22px;
      text-align:center;
      color:#eaf2ff;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(10,16,30,.55);
      box-shadow: 0 30px 90px rgba(0,0,0,.6);
      backdrop-filter: blur(14px) saturate(120%);
    }
    .splash-logo{
      width: 88px;
      height: 88px;
      margin: 0 auto 10px;
      border-radius: 26px;
      display:grid;
      place-items:center;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      position:relative;
      overflow:hidden;
    }
    .splash-logo::before{
      content:"";
      position:absolute;
      inset:-40%;
      background: conic-gradient(
        from 0deg,
        rgba(36,107,255,.0),
        rgba(36,107,255,.6),
        rgba(24,198,255,.55),
        rgba(124,58,237,.55),
        rgba(36,107,255,.0)
      );
      animation: spin 2.4s linear infinite;
      opacity:.9;
    }
    .splash-logo .logo-img{
      position:relative;
      width: 62px;
      height: 62px;
      border-radius: 22px;
      display:block;
      background: rgba(11,18,32,.92);
      border:1px solid rgba(255,255,255,.12);
      object-fit: contain;
      padding: 10px;
    }
    .splash-title{
      font-weight: 1000;
      letter-spacing: .6px;
      font-size: clamp(2.0rem, 4.2vw, 3.0rem);
      margin: 8px 0 6px;
    }
    .splash-sub{
      margin: 0;
      color: rgba(233,238,252,.78);
      font-weight: 700;
    }
    .splash-bar{
      height: 10px;
      margin: 16px auto 0;
      border-radius: 999px;
      width: min(380px, 82%);
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.10);
      overflow:hidden;
    }
    .splash-bar > i{
      display:block;
      height:100%;
      width: 40%;
      background: linear-gradient(90deg, rgba(36,107,255,.15), rgba(36,107,255,.85), rgba(24,198,255,.85));
      border-radius: 999px;
      animation: load 1.1s ease-in-out infinite;
      filter: drop-shadow(0 6px 14px rgba(36,107,255,.20));
    }
    .sr-only{
      position:absolute;
      width:1px;
      height:1px;
      padding:0;
      margin:-1px;
      overflow:hidden;
      clip:rect(0,0,0,0);
      border:0;
    }

    @keyframes load{
      0%{ transform: translateX(-30%); opacity:.65; }
      50%{ transform: translateX(120%); opacity:1; }
      100%{ transform: translateX(260%); opacity:.65; }
    }
    @keyframes spin{ to{ transform: rotate(360deg);} }

    @media (prefers-reduced-motion: reduce){
      .splash-logo::before, .splash-bar > i{ animation:none !important; }
      .splash{ transition:none; }
    }

    /* ========================= WHOAMI (overlay) ========================= */
    .whoami{
      position:fixed;
      inset:0;
      z-index:9998;
      display:none;
      place-items:center;
      padding:18px;
      background: rgba(7,11,20,.55);
      backdrop-filter: blur(10px) saturate(120%);
    }
    .whoami.show{ display:grid; }
    .who-card{
      width:min(92vw, 760px);
      border-radius: 22px;
      background:#fff;
      border:1px solid rgba(207,224,255,.85);
      box-shadow: 0 18px 60px rgba(0,0,0,.25);
      overflow:hidden;
    }
    .who-head{
      padding:14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom:1px solid rgba(207,224,255,.85);
      background: rgba(36,107,255,.06);
    }
    .who-title{
      margin:0;
      font-weight:1000;
      letter-spacing:.2px;
    }
    .who-body{ padding:16px; }
    .who-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width:860px){ .who-grid{ grid-template-columns:1fr; } }

    .who-box{
      border:1px solid rgba(207,224,255,.85);
      border-radius:16px;
      padding:12px;
      background:#fff;
    }
    .who-box strong{ display:block; margin-bottom:4px; }
    .who-actions{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:12px;
    }
  </style>
</head>
<body>

  <!-- Splash Screen Airconekta -->
  <div class="splash" id="splash" aria-label="Cargando Airconekta">
    <div class="splash-card" role="status" aria-live="polite">
      <div class="splash-logo" aria-hidden="true">
        <img class="logo-img" alt="" src="https://raw.githubusercontent.com/airconekta/airconekta/refs/heads/main/airconekta_logo_transparent.png" />
      </div>
      <div class="splash-title">AIRCONEKTA</div>
      <p class="splash-sub">Instalaciones ¬∑ Atenci√≥n local</p>
      <div class="splash-bar" aria-hidden="true"><i></i></div>
      <p class="sr-only">Cargando‚Ä¶</p>
    </div>
  </div>

  <!-- WHOAMI overlay (solo con #whoami) -->
  <section id="whoami" class="whoami" aria-label="Whoami">
    <div class="who-card" role="dialog" aria-modal="true" aria-labelledby="whoTitle">
      <div class="who-head">
        <h2 class="who-title" id="whoTitle">Whoami</h2>
        <button type="button" class="btn" id="whoClose">Cerrar ‚úï</button>
      </div>
      <div class="who-body">
        <div class="who-grid">
          <div class="who-box">
            <strong>üë§ Nombre</strong>
            <div id="whoName">Jair Elizondo</div>
          </div>
          <div class="who-box">
            <strong>üß© Rol</strong>
            <div id="whoRole">Soporte / Instalaciones ¬∑ Airconekta</div>
          </div>
          <div class="who-box">
            <strong>üìû Tel√©fono</strong>
            <div id="whoPhone">322 243 9782</div>
          </div>
          <div class="who-box">
            <strong>üîó Tip</strong>
            <div id="whoTip">Agrega <b>#whoami</b> al final de la URL</div>
          </div>
        </div>

        <div class="who-actions">
          <a class="btn btn-primary" id="whoWa" href="#" rel="noopener noreferrer">üü¢ Abrir WhatsApp</a>
          <a class="btn" id="whoCall" href="#">üìû Llamar</a>
          <button class="btn" type="button" id="whoCopy">üìã Copiar datos</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Pantalla inicial: selecci√≥n de colonia (full-screen, sin slide) -->
  <section id="welcome" class="welcome" aria-label="Seleccionar colonia">
    <div class="welcome-top">
      <h2 class="welcome-title">Selecciona tu colonia</h2>
      <p class="welcome-sub">Esto nos ayuda a atenderte m√°s r√°pido. Luego llenas el formulario y se abre WhatsApp con el mensaje listo.</p>
    </div>

    <div class="welcome-body">
      <div id="coloniaButtons" class="welcome-grid"></div>

      <div style="margin-top:14px">
        <label for="coloniaSelect" style="display:block; font-size:.92rem; color:var(--muted); margin:4px 0 6px;">
          Si no ves tu colonia, selecci√≥nala aqu√≠ (modo compatible):
        </label>
        <select id="coloniaSelect" class="welcome-select">
          <option value="" selected>Selecciona una colonia‚Ä¶</option>
        </select>
      </div>
    </div>

    <div class="welcome-footer">
      <span class="status" id="welcomeStatus">A√∫n no seleccionas colonia</span>
      <button type="button" class="btn" id="skipColonia">Continuar sin colonia</button>
    </div>
  </section>

  <div class="shell">
    <nav class="nav">
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <img alt="" src="https://raw.githubusercontent.com/airconekta/airconekta/refs/heads/main/airconekta_logo_transparent.png">
        </div>
        <div>Airconekta <span style="opacity:.65;font-weight:600">Instalaciones</span></div>
      </div>
      <div class="inline">
        <button id="installBtn" class="btn" style="display:none">‚ûï Instalar</button>
        <a class="btn" href="#" id="shareBtn" title="Compartir app">‚á™ Compartir</a>
      </div>
    </nav>

    <section class="card">
      <h1>Solicitar instalaci√≥n</h1>
      <p class="lead">Completa tus datos. La ubicaci√≥n es <strong>opcional</strong>. Al final se abrir√° WhatsApp con tu informaci√≥n formateada.</p>

      <form id="form" novalidate>
        <input type="hidden" id="colonia" name="colonia" />

        <div class="col-6">
          <label for="nombre">Nombre completo</label>
          <input id="nombre" name="nombre" placeholder="Tu nombre" required autocomplete="name" />
        </div>
        <div class="col-6">
          <label for="telefono">Tel√©fono</label>
          <input id="telefono" name="telefono" inputmode="numeric" autocomplete="tel" placeholder="10 d√≠gitos" pattern="[0-9]{10}" title="Debe contener exactamente 10 d√≠gitos (solo n√∫meros 0-9)" required />
        </div>

        <div class="col-12">
          <label for="direccion">Direcci√≥n (calle y n√∫mero)</label>
          <input id="direccion" name="direccion" placeholder="Ej: Calle Ju√°rez 123" required autocomplete="street-address" />
        </div>

        <div class="col-6">
          <label for="correo">Correo</label>
          <input id="correo" name="correo" type="email" placeholder="correo@ejemplo.com" required autocomplete="email" />
        </div>

        <div class="col-6">
          <label for="metodo">M√©todo de contacto</label>
          <select id="metodo" name="metodo" required>
            <option value="" disabled selected>Selecciona una opci√≥n</option>
            <option>Internet</option>
            <option>Volantes</option>
            <option>Recomendaci√≥n</option>
          </select>
        </div>

        <div class="col-6">
          <label for="plan">Plan deseado</label>
          <select id="plan" name="plan" required>
            <option value="" disabled selected>Selecciona un plan</option>
            <option value="Plan 300 ‚Äî 15 Mbps">Plan 300 ‚Äî 15 Mbps</option>
            <option value="Plan 400 ‚Äî 20 Mbps">Plan 400 ‚Äî 20 Mbps</option>
            <option value="Plan 600 ‚Äî 25 Mbps">Plan 600 ‚Äî 25 Mbps</option>
          </select>
        </div>

        <div class="col-6">
          <label>Ubicaci√≥n (GPS)</label>
          <div class="inline">
            <button type="button" class="btn" id="geoBtn">üìç Obtener ubicaci√≥n</button>
            <span id="geoStatus" class="status">Sin ubicaci√≥n</span>
          </div>
          <input type="hidden" id="lat" name="lat" />
          <input type="hidden" id="lng" name="lng" />
        </div>

        <div class="col-12">
          <button type="submit" class="btn btn-primary" id="sendBtn">üì® Enviar informaci√≥n</button>
        </div>
      </form>
      <div id="toast" class="toast" role="status" aria-live="polite"></div>
    </section>

    <div class="footer">
      <span>¬© <span id="year"></span> Airconekta</span>
      <span style="opacity:.75">Hecho con ‚ù§Ô∏è para clientes felices</span>
    </div>
  </div>

  <script>
    // Configuraci√≥n
    const NUMERO_DESTINO = "5213222108817"; // fijo

    // Firma (debug / whoami)
    const WHOAMI = {
      name: "Jair Elizondo",
      phonePretty: "322 243 9782",
      phoneDigits: "3222439782",
      role: "Soporte / Instalaciones ¬∑ Airconekta",
      hint: "#whoami",
      webHint: "Agrega #whoami al final de la URL"
    };

    const LOGO_1024 = "https://raw.githubusercontent.com/airconekta/airconekta/refs/heads/main/airconekta_logo_1024.png";
    const LOGO_512 = "https://raw.githubusercontent.com/airconekta/airconekta/refs/heads/main/airconekta_logo_512.png";
    const LOGO_TRANS = "https://raw.githubusercontent.com/airconekta/airconekta/refs/heads/main/airconekta_logo_transparent.png";

    const $ = sel => document.querySelector(sel);
    const toast = (msg) => { const t = $('#toast'); t.textContent = msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 1800); };

    // Firma en consola (solo al depurar)
    (function consoleSignature(){
      try{
        const line = "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ";
        console.log("%c" + line, "color:#18c6ff;font-weight:900");
        console.log("%cAIRCONEKTA ¬∑ Firma de desarrollo", "color:#246bff;font-size:14px;font-weight:900");
        console.log("%c" + WHOAMI.name + "  ¬∑  " + WHOAMI.phonePretty + "  ¬∑  " + WHOAMI.hint, "color:#7c3aed;font-size:12px;font-weight:900");
        console.log("%c" + WHOAMI.webHint, "color:#5b6b86;font-size:12px;font-weight:800");
        console.log("%c" + line, "color:#18c6ff;font-weight:900");
      }catch{}
    })();

    // A√±o din√°mico
    $('#year').textContent = new Date().getFullYear();

    // Splash (3s)
    const splash = document.getElementById("splash");
    const hideSplash = () => splash?.classList.add("hide");
    splash?.addEventListener("click", hideSplash, { passive: true });
    window.addEventListener("load", () => { setTimeout(hideSplash, 3000); });

    // ===== Selecci√≥n de colonia (ultra compatible, sin slide) =====
    const COLONIAS = [
      "‚öíÔ∏è El Canton, JAL",
      "‚öíÔ∏è Fracc. Ex Haciendas San Angel, NAY",
      "‚öíÔ∏è Fracc. La Joya / Los Mangos, NAY",
      "‚öíÔ∏è Fracc. La Mision, NAY",
      "‚öíÔ∏è Fracc. Jardin De Las Arboledas, NAY",
      "‚öíÔ∏è Fracc. Los Anhelos, NAY",
      "‚öíÔ∏è Fracc. Palma Real, NAY",
      "‚öíÔ∏è Fracc. Parque Central, NAY",
      "‚öíÔ∏è Fracc. Primavera Residencial, NAY",
      "‚öíÔ∏è Fracc. Valle Dorado, NAY",
      "‚öíÔ∏è Fracc. Valle Esmeralda, NAY",
      "‚öíÔ∏è Fracc. Valle Marlin, NAY",
      "‚öíÔ∏è Fracc. Zafiro Residencial, NAY"
    ];

    // Oculta la app hasta elegir (sin depender de localStorage)
    document.documentElement.classList.add('app-hidden');

    function setColonia(value) {
      $('#colonia').value = value || '';
      const st = document.getElementById('welcomeStatus');
      st.textContent = value ? `Seleccionada: ${value}` : 'Continuando sin colonia';
    }

    function enterApp() {
      const w = document.getElementById('welcome');
      w.style.display = 'none';
      document.documentElement.classList.remove('app-hidden');
      setTimeout(() => { document.getElementById('nombre')?.focus(); }, 50);
    }

    // Render botones grandes + select nativo
    (function initColoniasUI(){
      const buttonsWrap = document.getElementById('coloniaButtons');
      const select = document.getElementById('coloniaSelect');

      buttonsWrap.innerHTML = '';
      COLONIAS.forEach(col => {
        const b = document.createElement('button');
        b.type = 'button';
        b.className = 'welcome-btn';
        b.textContent = col;
        b.addEventListener('click', () => {
          setColonia(col);
          enterApp();
          toast('Colonia lista ‚úÖ');
        });
        buttonsWrap.appendChild(b);

        const opt = document.createElement('option');
        opt.value = col;
        opt.textContent = col;
        select.appendChild(opt);
      });

      select.addEventListener('change', () => {
        if (!select.value) return;
        setColonia(select.value);
        enterApp();
        toast('Colonia lista ‚úÖ');
      });

      document.getElementById('skipColonia').addEventListener('click', () => {
        setColonia('');
        enterApp();
        toast('Continuando‚Ä¶');
      });
    })();

    // =====================
    // WHOAMI (hash route) ‚Äî sin afectar estructura/funci√≥n
    // =====================
    function showWhoami(){
      $("#whoName").textContent = WHOAMI.name;
      $("#whoRole").textContent = WHOAMI.role;
      $("#whoPhone").textContent = WHOAMI.phonePretty;
      $("#whoTip").innerHTML = `Agrega <b>${WHOAMI.hint}</b> al final de la URL`;

      const waLink =
        `https://api.whatsapp.com/send?phone=52${WHOAMI.phoneDigits}` +
        `&text=${encodeURIComponent("Hola üëã " + WHOAMI.name + ", necesito soporte / info de Airconekta.")}` +
        `&type=phone_number&app_absent=0`;

      $("#whoWa").setAttribute("href", waLink);
      $("#whoCall").setAttribute("href", `tel:+52${WHOAMI.phoneDigits}`);

      $("#whoCopy").onclick = async () => {
        const text =
          `${WHOAMI.name}\n` +
          `${WHOAMI.phonePretty}\n` +
          `Airconekta\n` +
          `Tip: ${location.origin + location.pathname}#whoami`;
        try{
          await navigator.clipboard.writeText(text);
          toast("Datos copiados ‚úÖ");
        }catch{
          toast("No se pudo copiar (permiso del navegador)");
        }
      };

      $("#whoClose").onclick = () => {
        $("#whoami").classList.remove("show");
        history.replaceState(null, "", location.pathname + location.search);
      };

      $("#whoami").classList.add("show");
    }

    function handleHash(){
      const h = (location.hash || "").toLowerCase().trim();
      if (h === "#whoami"){
        // si est√° el welcome abierto, lo dejamos (no tocamos tu flujo)
        // solo mostramos overlay
        showWhoami();
      }
    }
    window.addEventListener("hashchange", handleHash, { passive:true });
    handleHash();

    // Geolocalizaci√≥n
    $('#geoBtn').addEventListener('click', () => {
      const s = $('#geoStatus');
      if (!('geolocation' in navigator)) { s.textContent = 'Geolocalizaci√≥n no soportada'; toast('Tu navegador no soporta ubicaci√≥n'); return; }
      s.textContent = 'Obteniendo ubicaci√≥n‚Ä¶';
      navigator.geolocation.getCurrentPosition((pos) => {
        const { latitude, longitude } = pos.coords;
        $('#lat').value = latitude.toFixed(6);
        $('#lng').value = longitude.toFixed(6);
        s.textContent = `Lat ${$('#lat').value}, Lng ${$('#lng').value}`;
        toast('Ubicaci√≥n lista ‚úÖ');
      }, (err) => { console.warn(err); s.textContent = 'No se pudo obtener ubicaci√≥n'; toast('No se pudo obtener ubicaci√≥n'); }, { enableHighAccuracy: true, timeout: 12000, maximumAge: 0 });
    });

    function validarFormulario() {
      const form = $('#form');
      if (!form.checkValidity()) { form.reportValidity(); return false; }
      const telefono = $('#telefono').value.replace(/\D+/g, '');
      if (telefono.length !== 10) { toast('El tel√©fono debe tener 10 d√≠gitos'); $('#telefono').focus(); return false; }
      return true;
    }

    function construirMensaje() {
      const nombre = $('#nombre').value.trim();
      const direccion = $('#direccion').value.trim();
      const plan = $('#plan').value;
      const tel = $('#telefono').value.trim();
      const correo = $('#correo').value.trim();
      const metodo = $('#metodo').value;
      const colonia = ($('#colonia').value || '').trim();
      const lat = $('#lat').value; const lng = $('#lng').value;

      let msg = `Hola üëã\nMe gustar√≠a hablar sobre la contrataci√≥n de servicio.\n\n`;
      msg += `*Nombre:* ${nombre}\n`;
      msg += `*Direcci√≥n:* ${direccion}${colonia ? `, ${colonia}` : ''}\n`;
      msg += `*Plan deseado:* ${plan}\n`;
      msg += `*Tel√©fono:* ${tel}\n`;
      msg += `*Correo:* ${correo}\n`;
      msg += `*M√©todo de contacto:* ${metodo}\n`;
      if (lat && lng) msg += `*Ubicaci√≥n:* https://www.google.com/maps?q=${lat},${lng}\n`;
      return msg;
    }

    function enviarWhatsApp() {
      if (!validarFormulario()) return;
      const mensaje = construirMensaje();
      const url = `https://api.whatsapp.com/send?phone=${NUMERO_DESTINO}&text=${encodeURIComponent(mensaje)}&type=phone_number&app_absent=0`;
      window.open(url, '_blank');
      toast('Abriendo WhatsApp‚Ä¶');
    }

    $('#form').addEventListener('submit', (e) => { e.preventDefault(); enviarWhatsApp(); });

    // Compartir app (Web Share API)
    $('#shareBtn').addEventListener('click', async (e) => {
      e.preventDefault();
      if (navigator.share) {
        try { await navigator.share({ title: 'Airconekta Instalaciones', text: 'Solicita tu instalaci√≥n en 1 minuto', url: location.href }); }
        catch (err) { /* cancelado */ }
      } else {
        navigator.clipboard?.writeText(location.href);
        toast('Enlace copiado');
      }
    });

    // ‚Äî‚Äî‚Äî PWA: manifest + service worker (mismo flujo, solo mejor icon) ‚Äî‚Äî‚Äî
    const manifest = {
      name: 'Airconekta Instalaciones',
      short_name: 'Airconekta',
      description: 'Formulario PWA para solicitar instalaci√≥n y enviar datos por WhatsApp.',
      start_url: '.',
      display: 'standalone',
      background_color: '#0b1220',
      theme_color: '#0b1220',
      icons: [
        { src: LOGO_512, sizes: '512x512', type: 'image/png' },
        { src: LOGO_1024, sizes: '1024x1024', type: 'image/png' }
      ]
    };
    const manBlob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
    const manURL = URL.createObjectURL(manBlob);
    const link = document.createElement('link'); link.rel = 'manifest'; link.href = manURL; document.head.appendChild(link);

    // Service Worker (cache b√°sico)
    if ('serviceWorker' in navigator) {
      const swCode = `
        const CACHE = 'airconekta-instalacion-v2';
        self.addEventListener('install', e => {
          e.waitUntil(caches.open(CACHE).then(c => c.addAll([self.registration.scope])));
          self.skipWaiting();
        });
        self.addEventListener('activate', e => { e.waitUntil(self.clients.claim()); });
        self.addEventListener('fetch', e => {
          const req = e.request;
          if (req.method !== 'GET') return;
          e.respondWith(
            caches.match(req).then(r => r || fetch(req).then(res => {
              const copy = res.clone();
              caches.open(CACHE).then(c => c.put(req, copy));
              return res;
            }).catch(() => caches.match(self.registration.scope)))
          );
        });
      `;
      const swBlob = new Blob([swCode], { type: 'text/javascript' });
      const swURL = URL.createObjectURL(swBlob);
      navigator.serviceWorker.register(swURL).catch(()=>{});
    }

    // Bot√≥n instalar (PWA)
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      const btn = document.getElementById('installBtn');
      btn.style.display = 'inline-flex';
      btn.onclick = async () => {
        btn.disabled = true;
        try { await deferredPrompt.prompt(); await deferredPrompt.userChoice; }
        finally { deferredPrompt = null; btn.style.display = 'none'; }
      };
    });
  </script>
</body>
</html>
